---
// media.astro (GitHub - Astro project)
// Connects to Supabase to display media_assets
const SUPABASE_URL = import.meta.env.PUBLIC_SUPABASE_URL;
const SUPABASE_ANON_KEY = import.meta.env.PUBLIC_SUPABASE_ANON_KEY;
---

<html lang="en">
  <head>
    <title>Admin Media | Lou Gehrig Fan Club</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  </head>
  <body style="font-family: sans-serif; padding: 2rem;">
    <h1>Media Library (Admin)</h1>
    <div id="media"></div>

    <script type="module">
      const supabase = window.supabase.createClient(
        "{{SUPABASE_URL}}",
        "{{SUPABASE_ANON_KEY}}"
      );

      async function loadMedia() {
        const { data, error } = await supabase
          .from("media_assets")
          .select(`
            id,
            title,
            tags,
            moderation_status,
            is_public,
            media_locations (
              url,
              is_primary,
              provider
            )
          `);

        const container = document.getElementById("media");

        if (error) {
          container.innerText = "Error loading media: " + error.message;
          return;
        }

        container.innerHTML = data.map(item => `
          <div style="margin-bottom: 2rem; border-bottom: 1px solid #ccc; padding-bottom: 1rem;">
            <img src="${item.media_locations?.[0]?.url || ''}" width="150" />
            <h3>${item.title}</h3>
            <p><strong>Tags:</strong> ${item.tags?.join(', ')}</p>
            <p><strong>Status:</strong> ${item.moderation_status}</p>
            <p><strong>Visibility:</strong> ${item.is_public ? 'Public' : 'Private'}</p>
          </div>
        `).join('');
      }

      loadMedia();
    </script>
  </body>
</html>


